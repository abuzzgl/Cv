import logging
from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup, constants
from telegram.ext import Application, CommandHandler, CallbackQueryHandler, ContextTypes

# ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ
logging.basicConfig(format='%(asctime)s - %(name)s - %(levelname)s - %(message)s', level=logging.INFO)
logger = logging.getLogger(__name__)

# Ð¢Ð¾ÐºÐµÐ½ Ð²Ð°ÑˆÐµÐ³Ð¾ Ð±Ð¾Ñ‚Ð°
TOKEN = '7461283027:AAEHvnCWCQywbatd4rLGa6TlLn0X8HIPTWA'

# Ð¡Ð»Ð¾Ð²Ð°Ñ€ÑŒ Ð´Ð»Ñ Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ ÑÐ·Ñ‹ÐºÐ¾Ð² Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹
user_languages = {}

# Ð¡Ð»Ð¾Ð²Ð°Ñ€Ð¸ Ð´Ð»Ñ Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ Ð±Ð°Ð»Ð°Ð½ÑÐ¾Ð² Ð¸ Ð¸ÑÑ‚Ð¾Ñ€Ð¸Ð¸ Ð¿Ð¾ÐºÑƒÐ¿Ð¾Ðº
user_balances = {}
purchase_history = {}

# Ð¡Ð»Ð¾Ð²Ð°Ñ€ÑŒ Ñ Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´Ð°Ð¼Ð¸ Ñ‚ÐµÐºÑÑ‚Ð° Ð½Ð° Ñ€Ð°Ð·Ð½Ñ‹Ðµ ÑÐ·Ñ‹ÐºÐ¸
translations = {
    'ru': {
        'welcome_message': 'Ð”Ð¾Ð±Ñ€Ð¾ Ð¿Ð¾Ð¶Ð°Ð»Ð¾Ð²Ð°Ñ‚ÑŒ Ð² Ð½Ð°Ñˆ Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½!',
        'choose_category': 'Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸ÑŽ:',
        'choose_cc_type': 'Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ñ‚Ð¸Ð¿ CC:',
        'eu_cc_text': 'Ð¡Ñ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ: $12 Ð·Ð° ÑˆÑ‚ÑƒÐºÑƒ\nÐ¢Ð¾Ð²Ð°Ñ€: ðŸ‡ªðŸ‡º EU | ÐšÐ°Ñ€Ñ‚Ð° ðŸ‡ªðŸ‡º\nâš ï¸ **Ð’ ÐºÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸Ð¸ Ðº Ð¾Ð¿Ð»Ð°Ñ‚Ðµ Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ ÑƒÐºÐ°Ð¶Ð¸Ñ‚Ðµ ÐºÐ°ÐºÐ¾Ð¹ Ñ‚Ð¾Ð²Ð°Ñ€ Ð²Ñ‹ Ð¿Ñ€Ð¸Ð¾Ð±Ñ€ÐµÑ‚Ð°ÐµÑ‚Ðµ.**',
        'usa_cc_text': 'Ð¡Ñ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ: $15 Ð·Ð° ÑˆÑ‚ÑƒÐºÑƒ\nÐ¢Ð¾Ð²Ð°Ñ€: ðŸ‡ºðŸ‡¸ USA | ÐšÐ°Ñ€Ñ‚Ð° ðŸ‡ºðŸ‡¸\nâš ï¸ **Ð’ ÐºÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸Ð¸ Ðº Ð¾Ð¿Ð»Ð°Ñ‚Ðµ Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ ÑƒÐºÐ°Ð¶Ð¸Ñ‚Ðµ ÐºÐ°ÐºÐ¾Ð¹ Ñ‚Ð¾Ð²Ð°Ñ€ Ð²Ñ‹ Ð¿Ñ€Ð¸Ð¾Ð±Ñ€ÐµÑ‚Ð°ÐµÑ‚Ðµ.**',
        'asia_cc_text': 'Ð¡Ñ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ: $12 Ð·Ð° ÑˆÑ‚ÑƒÐºÑƒ\nÐ¢Ð¾Ð²Ð°Ñ€: ðŸ‡¯ðŸ‡µ ASIA | ÐšÐ°Ñ€Ñ‚Ð° ðŸ‡¯ðŸ‡µ\nâš ï¸ **Ð’ ÐºÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸Ð¸ Ðº Ð¾Ð¿Ð»Ð°Ñ‚Ðµ Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ ÑƒÐºÐ°Ð¶Ð¸Ñ‚Ðµ ÐºÐ°ÐºÐ¾Ð¹ Ñ‚Ð¾Ð²Ð°Ñ€ Ð²Ñ‹ Ð¿Ñ€Ð¸Ð¾Ð±Ñ€ÐµÑ‚Ð°ÐµÑ‚Ðµ.**',
        '3ds_text': 'ðŸ’³ 3D-s Merchant\nðŸ“ Ð“ÐµÐ¾/Ð’Ð°Ð»ÑŽÑ‚Ð°: EUR, GBP, PLN, CZK, USD, AMD, AZN, BAM, BGN, CAD, CHF, DKK, GEL, HRK, HUF, ILS, INR, ISK, KGS, KZT, MDL, NOK, RON, RSD, SEK, TJS, TRY, UZS, VND, AED\nðŸ” Ð’ÐµÑ€Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ñ: KYC\nÐ¡Ñ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ: $250\nâš ï¸ **Ð’ ÐºÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸Ð¸ Ðº Ð¾Ð¿Ð»Ð°Ñ‚Ðµ Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ ÑƒÐºÐ°Ð¶Ð¸Ñ‚Ðµ ÐºÐ°ÐºÐ¾Ð¹ Ñ‚Ð¾Ð²Ð°Ñ€ Ð²Ñ‹ Ð¿Ñ€Ð¸Ð¾Ð±Ñ€ÐµÑ‚Ð°ÐµÑ‚Ðµ.**',
        'rules_text': 'ðŸŽ© ÐŸÑ€Ð°Ð²Ð¸Ð»Ð° Ð½Ð°ÑˆÐµÐ³Ð¾ Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ð°, Ð¾Ð·Ð½Ð°ÐºÐ¾Ð¼ÑŒÑ‚ÐµÑÑŒ Ñ Ð½Ð¸Ð¼Ð¸ Ð¿ÐµÑ€ÐµÐ´ Ð¿Ð¾ÐºÑƒÐ¿ÐºÐ¾Ð¹ Ñ‡ÐµÐ³Ð¾-Ð»Ð¸Ð±Ð¾ Ñƒ Ð½Ð°Ñ.\n\nðŸš« ÐŸÐ¾Ð²ÐµÐ´ÐµÐ½Ð¸Ðµ:\n1.1 ÐžÑÐºÐ¾Ñ€Ð±Ð»ÐµÐ½Ð¸Ðµ Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸Ð¸ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð° - Ð¾Ñ‚ÐºÐ°Ð· Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒ Ñ‚Ð¾Ð²Ð°Ñ€\n1.2 ÐÐºÑ‚Ð¸Ð²Ð½Ð¾Ðµ Ñ€Ð°ÑÐ¿Ñ€Ð¾ÑÑ‚Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ Ð·Ð°Ð²ÐµÐ´Ð¾Ð¼Ð¾ Ð»Ð¾Ð¶Ð½Ð¾Ð¹ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ð¸ Ð¾ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ðµ â€“ Ð¾Ñ‚ÐºÐ°Ð· Ð² Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‚Ðµ Ñ‚Ð¾Ð²Ð°Ñ€Ð°\n1.3 ÐŸÐ¾Ð¿Ñ‹Ñ‚ÐºÐ° Ð¾Ð±Ð¼Ð°Ð½ÑƒÑ‚ÑŒ Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸ÑŽ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð° - Ð¾Ñ‚ÐºÐ°Ð· Ð² Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‚Ðµ Ñ‚Ð¾Ð²Ð°Ñ€Ð°\n\nðŸ“ Ð£ÑÐ»Ð¾Ð²Ð¸Ñ:\n2.1 ÐŸÐµÑ€ÐµÐ´Ð°Ñ‡Ð° ÐºÐ°Ñ€Ñ‚ Ñ‚Ñ€ÐµÑ‚ÑŒÐ¸Ð¼ Ð»Ð¸Ñ†Ð°Ð¼ â€“ Ð¾Ñ‚ÐºÐ°Ð· Ð² Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‚Ðµ Ñ‚Ð¾Ð²Ð°Ñ€Ð°\n2.2 ÐŸÐ¾ÑÐ»Ðµ ÑÐ¾Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ñ Ð¿Ð¾ÐºÑƒÐ¿ÐºÐ¸ Ð² Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ðµ Ñƒ Ð²Ð°Ñ ÐµÑÑ‚ÑŒ 15 Ð¼Ð¸Ð½ÑƒÑ‚, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚ÑŒ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‚ (Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‚ Ð¾ÑÑƒÑ‰ÐµÑÑ‚Ð²Ð»ÑÐµÑ‚ÑÑ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð½Ð° Ð±Ð°Ð»Ð°Ð½Ñ Ð°ÐºÐºÐ°ÑƒÐ½Ñ‚Ð°)\n2.3 Ð’Ð¸Ð´ÐµÐ¾Ð´Ð¾ÐºÐ°Ð·Ð°Ñ‚ÐµÐ»ÑŒÑÑ‚Ð²Ð° Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ñ‹ Ñ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚Ð° Ð¿Ð¾ÐºÑƒÐ¿ÐºÐ¸ Ð´Ð¾ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚Ð° Ð²Ð¾Ð¶Ð´ÐµÐ½Ð¸Ñ.\n2.4 ÐÐµÑƒÐ´Ð°Ñ‡Ð½Ð°Ñ Ð¿Ð¾Ð¿Ñ‹Ñ‚ÐºÐ° Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Ñ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»Ð¾Ð¼ Ñ Ð²Ð°ÑˆÐµÐ¹ ÑÑ‚Ð¾Ñ€Ð¾Ð½Ñ‹ Ð¼Ð¾ÑˆÐµÐ½Ð½Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾/Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‚ Ð´ÐµÐ½ÐµÐ³ - Ð¾Ñ‚ÐºÐ°Ð· Ð² Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‚Ðµ Ñ‚Ð¾Ð²Ð°Ñ€Ð°\n2.5 ÐŸÐ¾ÑÐ»Ðµ Ð¾Ð¿Ð»Ð°Ñ‚Ñ‹ Ñ‚Ð¾Ð²Ð°Ñ€Ð° Ð²Ñ‹ Ð´Ð¾Ð»Ð¶Ð½Ñ‹ Ð½Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒ Ð² Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶ÐºÑƒ, ÐºÐ°ÐºÐ¾Ð¹ Ð¸Ð¼ÐµÐ½Ð½Ð¾ Ñ‚Ð¾Ð²Ð°Ñ€ Ð²Ñ‹ Ð¿Ñ€Ð¸Ð¾Ð±Ñ€ÐµÐ»Ð¸, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ ÐµÐ³Ð¾.',
        'profile_text': 'ðŸ‘¤ ÐŸÑ€Ð¾Ñ„Ð¸Ð»ÑŒ\nID: {user_id}\nðŸ’° Ð‘Ð°Ð»Ð°Ð½Ñ: ${balance}\nðŸ’³ Ð’ÑÐµÐ³Ð¾ Ð¿Ð¾Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¾: ${total_added}\nðŸ† Ð¡Ñ‚Ð°Ñ‚ÑƒÑ: {status}',
        'language_changed': 'Ð¯Ð·Ñ‹Ðº Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½ Ð½Ð° Ñ€ÑƒÑÑÐºÐ¸Ð¹!',
        'statuses_text': 'ðŸ† Ð”Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹Ðµ ÑÑ‚Ð°Ñ‚ÑƒÑÑ‹:\n\n1. **ÐÐ¾Ð²Ð¸Ñ‡Ð¾Ðº** (0-5 Ð¿Ð¾ÐºÑƒÐ¿Ð¾Ðº)\n2. **Ð›ÑŽÐ±Ð¸Ñ‚ÐµÐ»ÑŒ ÑÐºÐ¸Ð´Ð¾Ðº** (6-10 Ð¿Ð¾ÐºÑƒÐ¿Ð¾Ðº ÑÐ¾ ÑÐºÐ¸Ð´ÐºÐ¾Ð¹)\n3. **Ð—Ð°Ð²ÑÐµÐ³Ð´Ð°Ñ‚Ð°Ð¹** (11-20 Ð¿Ð¾ÐºÑƒÐ¿Ð¾Ðº)\n4. **Ð¦ÐµÐ½Ð¸Ñ‚ÐµÐ»ÑŒ ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ð°** (21-30 Ð¿Ð¾ÐºÑƒÐ¿Ð¾Ðº Ð±ÐµÐ· Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‚Ð¾Ð²)\n5. **Ð­Ð»Ð¸Ñ‚Ð½Ñ‹Ð¹ ÐºÐ»Ð¸ÐµÐ½Ñ‚** (31-50 Ð¿Ð¾ÐºÑƒÐ¿Ð¾Ðº Ð½Ð° ÑÑƒÐ¼Ð¼Ñƒ Ð±Ð¾Ð»ÐµÐµ $1000)\n6. **Ð›ÐµÐ³ÐµÐ½Ð´Ð° Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ð°** (51+ Ð¿Ð¾ÐºÑƒÐ¿Ð¾Ðº, ÑÐ¾Ð²ÐµÑ€ÑˆÐ¸Ð» Ð¿Ð¾ÐºÑƒÐ¿ÐºÑƒ Ð² Ð¿ÐµÑ€Ð²Ñ‹Ð¹ Ð´ÐµÐ½ÑŒ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Ð±Ð¾Ñ‚Ð°)\n7. **ÐŸÐ¾Ñ‡ÐµÑ‚Ð½Ñ‹Ð¹ Ñ‡Ð»ÐµÐ½ ÐºÐ»ÑƒÐ±Ð°** (100+ Ð¿Ð¾ÐºÑƒÐ¿Ð¾Ðº, Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð¾Ð²Ð°Ð» Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½ 10+ Ð´Ñ€ÑƒÐ·ÑŒÑÐ¼)',
        'add_funds': 'Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ ÑÑƒÐ¼Ð¼Ñƒ Ð¿Ð¾Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ:',
        'funds_added': 'Ð‘Ð°Ð»Ð°Ð½Ñ Ð¿Ð¾Ð¿Ð¾Ð»Ð½ÐµÐ½ Ð½Ð° ${amount}',
        'purchase_history': 'Ð’Ð°ÑˆÐ° Ð¸ÑÑ‚Ð¾Ñ€Ð¸Ñ Ð¿Ð¾ÐºÑƒÐ¿Ð¾Ðº:',
        'no_purchases': 'Ð£ Ð²Ð°Ñ Ð¿Ð¾ÐºÐ° Ð½ÐµÑ‚ Ð¿Ð¾ÐºÑƒÐ¿Ð¾Ðº.'
    },
    'en': {
        'welcome_message': 'Welcome to our store!',
        'choose_category': 'Select a category:',
        'choose_cc_type': 'Select a CC type:',
        'eu_cc_text': 'Price: $12 per item\nProduct: ðŸ‡ªðŸ‡º EU | Card ðŸ‡ªðŸ‡º\nâš ï¸ **Please specify the product you are purchasing in the payment comment.**',
        'usa_cc_text': 'Price: $15 per item\nProduct: ðŸ‡ºðŸ‡¸ USA | Card ðŸ‡ºðŸ‡¸\nâš ï¸ **Please specify the product you are purchasing in the payment comment.**',
        'asia_cc_text': 'Price: $12 per item\nProduct: ðŸ‡¯ðŸ‡µ ASIA | Card ðŸ‡¯ðŸ‡µ\nâš ï¸ **Please specify the product you are purchasing in the payment comment.**',
        '3ds_text': 'ðŸ’³ 3D-s Merchant\nðŸ“ Geo/Currency: EUR, GBP, PLN, CZK, USD, AMD, AZN, BAM, BGN, CAD, CHF, DKK, GEL, HRK, HUF, ILS, INR, ISK, KGS, KZT, MDL, NOK, RON, RSD, SEK, TJS, TRY, UZS, VND, AED\nðŸ” Verification: KYC\nPrice: $250\nâš ï¸ **Please specify the product you are purchasing in the payment comment.**',
        'rules_text': 'ðŸŽ© Rules of our store, please read them before purchasing anything from us.\n\nðŸš« Behavior:\n1.1 Insulting the project administration - refusal to return the product\n1.2 Active dissemination of deliberately false information about the project - refusal to return the product\n1.3 Attempt to deceive the project administration - refusal to return the product\n\nðŸ“ Conditions:\n2.1 Transfer of cards to third parties - refusal to return the product\n2.2 After making a purchase in the store, you have 15 minutes to open a return (returns are made only to the account balance)\n2.3 Video evidence is necessary from the moment of purchase to the moment of driving.\n2.4 Unsuccessful attempt to work with the material on your part fraud/refund - refusal to return the product\n2.5 After paying for the product, you must write to support which product you purchased in order to receive it.',
        'profile_text': 'ðŸ‘¤ Profile\nID: {user_id}\nðŸ’° Balance: ${balance}\nðŸ’³ Total added: ${total_added}\nðŸ† Status: {status}',
        'language_changed': 'Language changed to English!',
        'statuses_text': 'ðŸ† Available statuses:\n\n1. **Newbie** (0-5 purchases)\n2. **Discount Lover** (6-10 purchases with discount)\n3. **Regular** (11-20 purchases)\n4. **Quality Connoisseur** (21-30 purchases without returns)\n5. **Elite Client** (31-50 purchases totaling more than $1000)\n6. **Store Legend** (51+ purchases, made a purchase on the first day of the bot\'s operation)\n7. **Honorary Club Member** (100+ purchases, recommended the store to 10+ friends)',
        'add_funds': 'Select amount to add:',
        'funds_added': 'Added ${amount} to balance',
        'purchase_history': 'Your purchase history:',
        'no_purchases': 'You have no purchases yet.'
    }
}

# Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ Ð´Ð»Ñ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ ÐºÐ»Ð°Ð²Ð¸Ð°Ñ‚ÑƒÑ€Ñ‹ Ð³Ð»Ð°Ð²Ð½Ð¾Ð³Ð¾ Ð¼ÐµÐ½ÑŽ
def main_menu_keyboard(user_language):
    keyboard = [
        [InlineKeyboardButton("ðŸ’³ ÐšÑƒÐ¿Ð¸Ñ‚ÑŒ Ñ‚Ð¾Ð²Ð°Ñ€" if user_language == 'ru' else "ðŸ’³ Buy product", callback_data='buy')],
        [InlineKeyboardButton("ðŸŽ© ÐŸÑ€Ð°Ð²Ð¸Ð»Ð°" if user_language == 'ru' else "ðŸŽ© Rules", callback_data='rules')],
        [InlineKeyboardButton("ðŸ†˜ ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ°" if user_language == 'ru' else "ðŸ†˜ Support", url='http://t.me/CV_SHOP_SUPPORT_BOT')],
        [InlineKeyboardButton(f"ðŸ‡·ðŸ‡º | ðŸ‡¬ðŸ‡§", callback_data='change_language')],
        [InlineKeyboardButton("ðŸ‘¤ ÐŸÑ€Ð¾Ñ„Ð¸Ð»ÑŒ" if user_language == 'ru' else "ðŸ‘¤ Profile", callback_data='profile')],
        [InlineKeyboardButton("ðŸ† Ð¡Ñ‚Ð°Ñ‚ÑƒÑÑ‹" if user_language == 'ru' else "ðŸ† Statuses", callback_data='statuses')],
        [InlineKeyboardButton("ðŸ’° ÐŸÐ¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÑŒ Ð±Ð°Ð»Ð°Ð½Ñ" if user_language == 'ru' else "ðŸ’° Add funds", callback_data='add_funds')]
    ]
    return InlineKeyboardMarkup(keyboard)

# ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ /start
async def start(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    user_id = update.effective_user.id
    user_languages[user_id] = 'ru'  # Ð£ÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ ÑÐ·Ñ‹Ðº Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ
    user_balances[user_id] = 0  # Ð£ÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ Ð½Ð°Ñ‡Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð±Ð°Ð»Ð°Ð½Ñ
    purchase_history[user_id] = []  # Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð¸Ñ€ÑƒÐµÐ¼ Ð¸ÑÑ‚Ð¾Ñ€Ð¸ÑŽ Ð¿Ð¾ÐºÑƒÐ¿Ð¾Ðº
    await update.message.reply_text(translations['ru']['welcome_message'], reply_markup=main_menu_keyboard('ru'))

# ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº Ð½Ð°Ð¶Ð°Ñ‚Ð¸Ð¹ Ð½Ð° ÐºÐ½Ð¾Ð¿ÐºÐ¸
async def button(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    query = update.callback_query
    user_id = update.effective_user.id
    user_language = user_languages.get(user_id, 'ru')
    await query.answer()

    if query.data == 'buy':
        categories_keyboard = [
            [InlineKeyboardButton("ðŸ’³ CC", callback_data='cc')],
            [InlineKeyboardButton("ðŸ‘ï¸â€ðŸ—¨ï¸ 3D-s Merchant", callback_data='3ds')],
            [InlineKeyboardButton("ðŸ”™ ÐÐ°Ð·Ð°Ð´" if user_language == 'ru' else "ðŸ”™ Back", callback_data='back_to_main')]
        ]
        await query.edit_message_text(text=translations[user_language]['choose_category'], reply_markup=InlineKeyboardMarkup(categories_keyboard))
    
    elif query.data == 'cc':
        cc_keyboard = [
            [InlineKeyboardButton("ðŸ‡ªðŸ‡º EU | ÐšÐ°Ñ€Ñ‚Ð° ðŸ‡ªðŸ‡º" if user_language == 'ru' else "ðŸ‡ªðŸ‡º EU | Card ðŸ‡ªðŸ‡º", callback_data='eu_cc'), InlineKeyboardButton("ðŸ‡ºðŸ‡¸ USA | ÐšÐ°Ñ€Ñ‚Ð° ðŸ‡ºðŸ‡¸" if user_language == 'ru' else "ðŸ‡ºðŸ‡¸ USA | Card ðŸ‡ºðŸ‡¸", callback_data='usa_cc')],
            [InlineKeyboardButton("ðŸ‡¯ðŸ‡µ ASIA | ÐšÐ°Ñ€Ñ‚Ð° ðŸ‡¯ðŸ‡µ" if user_language == 'ru' else "ðŸ‡¯ðŸ‡µ ASIA | Card ðŸ‡¯ðŸ‡µ", callback_data='asia_cc')],
            [InlineKeyboardButton("ðŸ”™ ÐÐ°Ð·Ð°Ð´" if user_language == 'ru' else "ðŸ”™ Back", callback_data='back_to_categories')]
        ]
        await query.edit_message_text(text=translations[user_language]['choose_cc_type'], reply_markup=InlineKeyboardMarkup(cc_keyboard))
    
    elif query.data in ['eu_cc', 'usa_cc', 'asia_cc']:
        buy_keyboard = [[InlineKeyboardButton("ÐšÑƒÐ¿Ð¸Ñ‚ÑŒ Ñ‚Ð¾Ð²Ð°Ñ€ ðŸ§¾" if user_language == 'ru' else "Buy product ðŸ§¾", url='http://t.me/send?start=IVv9vLCqReZm')]]
        await query.edit_message_text(
            text=translations[user_language][f'{query.data}_text'],
            reply_markup=InlineKeyboardMarkup(buy_keyboard),
            parse_mode='Markdown'
        )
    
    elif query.data == '3ds':
        buy_keyboard = [[InlineKeyboardButton("ÐšÑƒÐ¿Ð¸Ñ‚ÑŒ Ñ‚Ð¾Ð²Ð°Ñ€ ðŸ§¾" if user_language == 'ru' else "Buy product ðŸ§¾", url='http://t.me/send?start=IVv9vLCqReZm')]]
        await query.edit_message_text(
            text=translations[user_language]['3ds_text'],
            reply_markup=InlineKeyboardMarkup(buy_keyboard),
            parse_mode='Markdown'
        )
    
    elif query.data == 'rules':
        rules_keyboard = [[InlineKeyboardButton("ðŸ”™ ÐÐ°Ð·Ð°Ð´" if user_language == 'ru' else "ðŸ”™ Back", callback_data='back_to_main')]]
        await query.edit_message_text(text=translations[user_language]['rules_text'], reply_markup=InlineKeyboardMarkup(rules_keyboard))
    
    elif query.data == 'profile':
        profile_text = translations[user_language]['profile_text'].format(
            user_id=update.effective_user.id,
            balance=user_balances.get(user_id, 0),
            total_added=user_balances.get(user_id, 0),
            status='ÐÐ¾Ð²Ð¸Ñ‡Ð¾Ðº' if user_language == 'ru' else 'Beginner'
        )
        profile_keyboard = [
            [InlineKeyboardButton("ðŸ“‹ Ð˜ÑÑ‚Ð¾Ñ€Ð¸Ñ Ð¿Ð¾ÐºÑƒÐ¿Ð¾Ðº" if user_language == 'ru' else "ðŸ“‹ Purchase history", callback_data='purchase_history')],
            [InlineKeyboardButton(f"ðŸ‡·ðŸ‡º | ðŸ‡¬ðŸ‡§", callback_data='change_language')],
            [InlineKeyboardButton("ðŸ”™ ÐÐ°Ð·Ð°Ð´" if user_language == 'ru' else "ðŸ”™ Back", callback_data='back_to_main')]
        ]
        await query.edit_message_text(text=profile_text, reply_markup=InlineKeyboardMarkup(profile_keyboard))
    
    elif query.data == 'statuses':
        await query.edit_message_text(text=translations[user_language]['statuses_text'], parse_mode='Markdown', reply_markup=InlineKeyboardMarkup([[InlineKeyboardButton("ðŸ”™ ÐÐ°Ð·Ð°Ð´" if user_language == 'ru' else "ðŸ”™ Back", callback_data='back_to_main')]]))
    
    elif query.data == 'change_language':
        user_languages[user_id] = 'en' if user_language == 'ru' else 'ru'
        await query.edit_message_text(translations[user_languages[user_id]]['language_changed'], reply_markup=main_menu_keyboard(user_languages[user_id]))
    
    elif query.data == 'add_funds':
        add_funds_keyboard = [
            [InlineKeyboardButton("$10", callback_data='add_10')],
            [InlineKeyboardButton("$50", callback_data='add_50')],
            [InlineKeyboardButton("$100", callback_data='add_100')],
            [InlineKeyboardButton("ðŸ”™ ÐÐ°Ð·Ð°Ð´" if user_language == 'ru' else "ðŸ”™ Back", callback_data='back_to_main')]
        ]
        await query.edit_message_text(text=translations[user_language]['add_funds'], reply_markup=InlineKeyboardMarkup(add_funds_keyboard))

    elif query.data.startswith('add_'):
        amount = int(query.data.split('_')[1])
        user_balances[user_id] = user_balances.get(user_id, 0) + amount
        await query.answer(translations[user_language]['funds_added'].format(amount=amount))
        await query.edit_message_text(text=translations[user_language]['welcome_message'], reply_markup=main_menu_keyboard(user_language))

    elif query.data == 'purchase_history':
        history = purchase_history.get(user_id, [])
        if history:
            history_text = translations[user_language]['purchase_history'] + '\n\n' + '\n'.join(history)
        else:
            history_text = translations[user_language]['no_purchases']
        await query.edit_message_text(text=history_text, reply_markup=InlineKeyboardMarkup([[InlineKeyboardButton("ðŸ”™ ÐÐ°Ð·Ð°Ð´" if user_language == 'ru' else "ðŸ”™ Back", callback_data='profile')]]))
    
    elif query.data in ['back_to_main', 'back_to_categories']:
        if query.data == 'back_to_main':
            await query.edit_message_text(text=translations[user_language]['welcome_message'], reply_markup=main_menu_keyboard(user_language))
        else:
            categories_keyboard = [
                [InlineKeyboardButton("ðŸ’³ CC", callback_data='cc')],
                [InlineKeyboardButton("ðŸ‘ï¸â€ðŸ—¨ï¸ 3D-s Merchant", callback_data='3ds')],
                [InlineKeyboardButton("ðŸ”™ ÐÐ°Ð·Ð°Ð´" if user_language == 'ru' else "ðŸ”™ Back", callback_data='back_to_main')]
            ]
            await query.edit_message_text(text=translations[user_language]['choose_category'], reply_markup=InlineKeyboardMarkup(categories_keyboard))

def main() -> None:
    application = Application.builder().token(TOKEN).build()

    application.add_handler(CommandHandler("start", start))
    application.add_handler(CallbackQueryHandler(button))

    application.run_polling()

if __name__ == '__main__':
    main()
